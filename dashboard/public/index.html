<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="format-detection" content="telephone=no" />
    <!--<meta name="viewport" content="user-scalable=yes, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Color Pattern Generator | LCARS SDK</title>
    <!--<base href="/">-->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <!--<base href="/">-->
    <script type="text/javascript" src="lcarssdk/js/jquery.js"></script>
    <script type="text/javascript" src="lcarssdk/js/webviewinfo.js"></script>
    <script type="text/javascript" src="lcarssdk/js/arrive.js"></script>
    <script type="text/javascript" src="lcarssdk/js/lcarssdk.js"></script>
    <script type="text/javascript" src="lcarssdk/addons/scrollbutton/scrollbutton.js"></script>
    <script type="text/javascript" src="lcarssdk/addons/levelbar/levelbar.js"></script>
    <script type="text/javascript" src="lcarssdk/templates/bracket/bracket.js"></script>
    <script type="text/javascript" src="lcarssdk/templates/dialog/dialog.js"></script>
    <script type="text/javascript" src="lcarssdk/templates/framing/framing.js"></script>
    <script type="text/javascript" src="lcarssdk/templates/button/button.js"></script>
    <script type="text/javascript" src="particles.js"></script>
    <script type="text/javascript" src="module.js"></script>
    <link rel="stylesheet" type="text/css" href="lcarssdk/css/lcarssdk.css">
    <link rel="stylesheet" type="text/css" href="lcarssdk/addons/scrollbutton/scrollbutton.css">
    <link rel="stylesheet" type="text/css" href="lcarssdk/addons/levelbar/levelbar.css">
    <link rel="stylesheet" type="text/css" href="lcarssdk/templates/bracket/bracket.css">
    <link rel="stylesheet" type="text/css" href="lcarssdk/templates/dialog/dialog.css">
    <link rel="stylesheet" type="text/css" href="lcarssdk/templates/framing/framing.css">
    <link rel="stylesheet" type="text/css" href="lcarssdk/templates/button/button.css">
    <link rel="stylesheet" type="text/css" href="lcarssdk/themes/theme_ussNotAffiliated.css">
    <link rel="stylesheet" type="text/css" href="module.css">
    <script type="text/javascript" src="animated_delta.js"></script>   
    <link rel="stylesheet" type="text/css" href="animated_delta.css">
    <script type="text/javascript" src="main.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-blue-grey.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<style> 
input[type=text] {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  box-sizing: border-box;
  border: none;
  background-color: black;
  color: white;
  text-align: center;
}

::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
  color: gray;
  opacity: 1; /* Firefox */
}

.center {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 50%;
}
div#banner { 
     width:100%;
     position: fixed;
     z-index: 100; 
     background: #000000;
     height: 20px;
     color: #FFFFFF;
     font-size: 12px;
     padding:5px; 
}
div#banner-content { 
  width: 800px; 
  margin: 0 auto; 
  padding: 10px; 
  border: 1px solid #000;
}

</style>

  </head>
  <body ontouchstart="" onload="main()" style="overflow:scroll">
  <div id="banner">
    <div id="banner-content"></div>
  </div>
    <div ng-app="scavenger_hunt" ng-controller="scavenger_hunt_Ctrl">
      <!-- Page Container -->
      <div class="w3-container w3-content" style="max-width:1400px;margin-top:20px;">
        <!-- The Grid -->
        <div class="w3-row">
          <!-- Left Column -->
          <div class="w3-col m3">
            <!-- Profile -->
            <div style="w3-card w3-black" ng-if="logged_in">
              <a class="button pill {{colorGen()}}" data-label="LOGOUT" href="/accounts/logout/" syle="max-height:30px">
              </a>
            </div>
            <br>
            <div class="w3-card w3-black">
              <div class="wrapper sdk bracket typeA w3-container" id="bracket_32">
                <div class="wrapper content" id="profile_pic">
                  <canvas class="particles-js-canvas-el"></canvas>
                  <img src="delta.png" id="delta">
                </div>
                <div class="elbow top-left small {{colorGen()}} no-event horizontal" id="elbow_6">
                  <div class="bar">
                    <div class="block"></div>
                  </div>
                  <div class="bar" id="bar_7"></div>
                </div>
                <div class="elbow top-right small {{colorGen()}} no-event horizontal" id="elbow_8">
                  <div class="bar">
                    <div class="block"></div>
                  </div>
                  <div class="bar" id="bar_9"></div>
                </div>
                <div class="elbow bottom-left small {{colorGen()}} no-event horizontal" id="elbow_10">
                  <div class="bar">
                    <div class="block"></div>
                  </div>
                  <div class="bar" id="bar_11"></div>
                </div>
                <div class="elbow bottom-right small {{colorGen()}} no-event horizontal" id="elbow_12">
                  <div class="bar">
                    <div class="block"></div>
                  </div>
                  <div class="bar" id="bar_13"></div>
                </div>
                <div class="column flexv" id="column_14">
                  <div class="bar flexcv {{colorGen()}}" id="bar_15"></div>
                  <div class="bar flexcv {{colorGen()}}" id="bar_16">
                    <div class="bar bg-white" id="bar_17"></div>
                  </div>
                  <div class="bar flexcv {{colorGen()}}" id="bar_18"></div>
                </div>
                <div class="column flexv" id="column_19">
                  <div class="bar flexcv {{colorGen()}}" id="bar_20"></div>
                  <div class="bar flexcv {{colorGen()}}" id="bar_21"></div>
                  <div class="bar flexcv {{colorGen()}}" id="bar_22"></div>
                </div>
                <div class="column flexv" id="column_23">
                  <div class="bar flexcv {{colorGen()}}" id="bar_24"></div>
                  <div class="bar flexcv {{colorGen()}}" id="bar_25">
                    <div class="bar bg-white" id="bar_26"></div>
                  </div>
                  <div class="bar flexcv {{colorGen()}}" id="bar_27"></div>
                </div>
                <div class="column flexv" id="column_28">
                  <div class="bar flexcv {{colorGen()}}" id="bar_29"></div>
                  <div class="bar flexcv {{colorGen()}}" id="bar_30"></div>
                  <div class="bar flexcv {{colorGen()}}" id="bar_31"></div>
                </div>
              </div>
            </div>
            <br>
            <div class="w3-card w3-black" ng-if="logged_out">
              <div class="w3-container">
                <a href="http://localhost:8001/login/facebook/">
                  <div class="button pill {{colorGen()}}" data-label="LOGIN" style="text-align:right;"></div>
                </a>
              </div>
            </div>
            <!-- Accordion -->
            <div class="w3-card w3-round" ng-if="logged_in">
              <div class="w3-black button-wrap">
                <div class="button {{colorGen()}}"  onclick="myFunction('rewards')" data-label="Rewards"></div>
                <div id="rewards" class="w3-hide w3-container">
                  <div ng-repeat="reward in rewards">
                    <div class="button {{colorGen()}} pill" data-label="Reward" style="text-align:right"></div>
                  </div>
                </div>
                <div class="button {{colorGen()}}"  onclick="myFunction('awards')" data-label="Awards"></div>
                <div id="rewards" class="w3-hide w3-container">
                  <div ng-repeat="award in awards">
                    <div class="button {{colorGen()}} pill" data-label="Award" style="text-align:right"></div>
                  </div>
                </div>
              </div>
            </div>
            <br>
            <!-- End Left Column -->
          </div>
          <!-- Middle Column -->
          <div class="w3-col m7" ng-if="logged_in">
            <div class="w3-row-padding">
              <div class="w3-col m12">
            <div class="w3-card w3-round" ng-if="logged_in">
              <div class="w3-black button-wrap">
                <div class="button {{colorGen()}}"  ng-click="showElement('challenges')" data-label="Challenges"></div>

                <div id="challenges" class="w3-hide w3-container">
                  <div ng-repeat="challenge in challenges">
                    <div class="bar {{colorGen()}}" data-label="Challenge {{challenge.id}}" style="text-align:right;margin-bottom:5px" ng-click="showElement('challenge_'+challenge.id.toString())"></div>
                    <div id="challenge_{{challenge.id}}" class="w3-hide w3-container">
                      <div>
                        <div ng-if="{{challenge.problem.question.picture}}" style="text-align: center;">
                          <img src="{{challenge.problem.question.picture}}" class="center">
                        </div>
                        <div ng-if="challenge.problem.question.video" style="text-align: center;">
                          <video width="320" height="240" class="center" controls="">
                            <source src="{{challenge.problem.question.video}}" type="video/mp4">
                          </video>
                        </div>
                        <div class="content flexcv" id="content_338">
                          <p id="htmlTag_345" class="htmlTag text-blue-2" style="text-align: center">
                            {{challenge.problem.question.text}}
                          </p>
                        <div class="row" style="max-height:30px" id="row_339">
                          <input id="answer_{{challenge.id}}" type="text" name="answer" placeholder="{{challenge.answer}}">
                          <div style='text-align:center;margin-top:10px;margin-right:20px;position:relative' ng-click="submitAnswer(challenge.id)" class="oval {{colorGen()}} small" id="button_2315" data-label="submit"></div>
                        </div>

                        </div>
                        <br>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="button {{colorGen()}}"  ng-click="showElement('completed_challenges')" data-label="Completed Challenges"></div>
                <div id="completed_challenges" class="w3-hide w3-container">
                  <div ng-repeat="challenge in completed_challenges">
                    <div class="button {{colorGen()}} pill" data-label="Challenge {{challenge.id}} (Complete)" style="text-align:right"></div>
                  </div>
                </div>
              </div>
            </div>

              </div>
            </div>
            <!-- End Middle Column -->
          </div>
          <!-- Right Column -->
          <div class="w3-col m2" ng-if="logged_in">
            <div class="w3-card w3-round w3-white w3-center">
              <div class="w3-container">
                <p>Upcoming Events:</p>
                <img src="/w3images/forest.jpg" alt="Forest" style="width:100%;">
                <p><strong>Holiday</strong></p>
                <p>Friday 15:00</p>
                <p><button class="w3-button w3-block w3-theme-l4">Info</button></p>
              </div>
            </div>
            <br>
            <div class="w3-card w3-round w3-white w3-center">
              <div class="w3-container">
                <p>Friend Request</p>
                <img src="/w3images/avatar6.png" alt="Avatar" style="width:50%"><br>
                <span>Jane Doe</span>
                <div class="w3-row w3-opacity">
                  <div class="w3-half">
                    <button class="w3-button w3-block w3-green w3-section" title="Accept"><i class="fa fa-check"></i></button>
                  </div>
                  <div class="w3-half">
                    <button class="w3-button w3-block w3-red w3-section" title="Decline"><i class="fa fa-remove"></i></button>
                  </div>
                </div>
              </div>
            </div>
            <br>
            <div class="w3-card w3-round w3-white w3-padding-16 w3-center">
              <p>ADS</p>
            </div>
            <br>
            <div class="w3-card w3-round w3-white w3-padding-32 w3-center">
              <p><i class="fa fa-bug w3-xxlarge"></i></p>
            </div>
            <!-- End Right Column -->
          </div>
          <!-- End Grid -->
        </div>
        <!-- End Page Container -->
      </div>
      <br>
      <!-- Footer -->
      <footer class="w3-container w3-theme-d3 w3-padding-16" ng-if="logged_in">
        <h5>Footer</h5>
      </footer>
      <footer class="w3-container w3-theme-d5" ng-if="logged_in">
        <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
      </footer>
    </div>
    <script>
      // Accordion
      function myFunction(id) {
        var x = document.getElementById(id);
        if (x.className.indexOf("w3-show") == -1) {
          x.className += " w3-show";
          x.previousElementSibling.className += " w3-theme-d1";
        } else { 
          x.className = x.className.replace("w3-show", "");
          x.previousElementSibling.className = 
          x.previousElementSibling.className.replace(" w3-theme-d1", "");
        }
      }
      
      // Used to toggle the menu on smaller screens when clicking on the menu button
      function openNav() {
        var x = document.getElementById("navDemo");
        if (x.className.indexOf("w3-show") == -1) {
          x.className += " w3-show";
        } else { 
          x.className = x.className.replace(" w3-show", "");
        }
      }
    </script>
    <script>
      var API_ROOT = "/api/"
      var app = angular.module("scavenger_hunt", []);
      function join_url_params(url, params){ return url +"?"+ params }
      app.config(function($httpProvider) {
$httpProvider.defaults.xsrfCookieName = 'csrftoken';
$httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
//  $httpProvider.interceptors.push('testInterceptor');
      }).controller("scavenger_hunt_Ctrl", function($scope,$http) {
         debugger; 
      //    var temp_api_root = "http://127.0.0.1:8000/api/scavenger_hunt/";
      //    var API_ROOT = temp_api_root;
          $scope.uiColors = [
              "bg-blue-1",
              "bg-blue-2",
              "bg-blue-3",
              "bg-blue-4",
              "bg-green-1",
              "bg-green-2",
              "bg-green-3",
              "bg-green-4"
          ];
          $scope.cookie = document.cookie.split('=')[1];
          $scope.colorGen = function(){
                return LCARS.colorGen($scope.uiColors)
          };
          API_ROOT = '/api/'
          var avatar_endpoint = API_ROOT + 'profile?format=json';
      
          $http.get(avatar_endpoint).then(
          function(response) {
              $scope.logged_in = Boolean(response.data.count);
              $scope.logged_out = !$scope.logged_in;
          },
          function(data) {
          
          });
          var challenge_endpoint = API_ROOT + 'challenges/unsolved/?format=json';
      
          $http.get(challenge_endpoint).then(
          function(response) {
              $scope.challenges = response.data.results;
          },
          function(data) {
          });
      
          var completed_challenge_endpoint = API_ROOT + 'challenges/solved?format=json';
      
          $http.get(completed_challenge_endpoint).then(
          function(response) {
              $scope.completed_challenges = response.data.results;
          },
          function(data) {
          });
      
      
          var reward_endpoint = API_ROOT + 'rewards/?format=json';
      
          $http.get(reward_endpoint).then(
          function(response) {
              $scope.rewards = response.data.results;
          },
          function(data) {
          });
      
      
          var award_endpoint = API_ROOT + 'awards/?format=json';
      
          $http.get(award_endpoint).then(
          function(response) {
              $scope.awards = response.data.results;
          },
          function(data) {
          });


      $scope.showElement = function(id) {
        var x = document.getElementById(id);
        if (x.className.indexOf("w3-show") == -1) {
          x.className += " w3-show";
          x.previousElementSibling.className += " w3-theme-d1";
        } else { 
          x.className = x.className.replace("w3-show", "");
          x.previousElementSibling.className = 
          x.previousElementSibling.className.replace(" w3-theme-d1", "");
        }
      }



      $scope.submitAnswer = function(id) {
        debugger;
        var answer_endpoint = API_ROOT + 'challenges/'+id.toString()+'/solve/?format=json'

        var a = document.getElementById('answer_'+id.toString());
        
        data = {
            'answer': a.value
        }
        $http.post(answer_endpoint,data).then(
          function(response) {
             debugger;
             var banner = document.getElementById("banner");
             var banner_content = document.getElementById("banner-content");

             var view_port = document.getElementById("bracket_32");
             banner_content.innerText = response.data.msg;
             banner.style.display = 'block';

             if (response.data.state=='penalty'){
                 if(response.data.penalty=='general'){
                    debugger;
                   if(view_port.classList.contains('red-alert')){
                     red_alert()
                   }               
                 } else if (response.data.penalty=='yellow'){
                   debugger;
                   if(view_port.classList.contains('red-alert')){
                     red_alert()
                   }
                 } else if (response.data.penalty=='red') {
                     debugger;
                   if(!view_port.classList.contains('red-alert')){
                     red_alert()
                   }
                 }
             } else if (response.data.state=='solved'){ 
                     debugger;
             }               
          },
          function(data) {
             debugger;
          }
        );

      setTimeout(function() {
           var banner = document.getElementById("banner");
           banner.style.display = 'none';
       }, 7000); // <-- time in milliseconds

      }


      
      });
    </script>
  </body>
</html>
